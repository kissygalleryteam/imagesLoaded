/*!build time : 2014-05-07 1:53:20 PM*/
KISSY.add("gallery/imagesLoaded/1.0/index",function(a,b,c,d){function e(a){var b=this;return b instanceof e?(e.superclass.constructor.call(b,a),void this._init(a)):new e(a)}function f(a){this.img=a}function g(a){this.src=a,i[a]=this}var h=b.all;a.augment(e,d.Target),a.extend(e,c,{_init:function(a){var b=this,c=a.elem,d=a.options,e=a.onAlways;b.checkedCount=0,b.imagesCount=0,b.hasAnyBroken=!1,b.isComplete=!1,"string"==typeof c&&(c=h(c)),b.elements=b._getElementsAsArray(c),"function"==typeof d?e=d:b.options=d,e&&b.on("always",e),b._getImages(),b._check()},_getElementsAsArray:function(b){var c=[];if(a.isArray(b))c=b;else if("number"==typeof b.length)for(var d=0;d<b.length;d++)c.push(b[d]);else c.push(b);return c},_getImages:function(){this.images=[];for(var a=0;a<this.elements.length;a++){var b=this.elements[a];"IMG"===b.nodeName&&this._addImage(b);var c=b.nodeType;if(c&&(1===c||9===c||11===c))for(var d=h(b).all("img"),e=0;e<d.length;e++)this._addImage(d[e])}},_addImage:function(a){this.imagesCount++;var b=new f(a);this.images.push(b)},_check:function(){function a(a){return b.checkedCount++,b._progress(a.image),b.checkedCount===b.imagesCount&&b._complete(),!0}var b=this;if(!b.imagesCount)return void b._complete();for(var c=0;c<b.imagesCount;c++){var d=b.images[c];d.on("confirm",a),d._check()}},_progress:function(a){this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded;var b=this;b.fire("progress",a)},_complete:function(){var a=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var b=this;b.fire(a,b),b.fire("always",b)}},{ATTRS:{}}),a.augment(f,d.Target),a.extend(f,c,{_check:function(){var a=this,b=i[this.img.src]||new g(this.img.src);return b.isConfirmed?void this._confirm(b.isLoaded,"cached was confirmed"):(b.on("confirm",function(b){a._confirm(!0,b)}),void b._check())},_confirm:function(a,b){this.isLoaded=b.isLoaded,this.fire("confirm",{image:this,message:b.message})}});var i={};return a.augment(g,d.Target),a.extend(g,c,{_check:function(){var a=this;if(!this.isChecked){var b=new Image;h(b).on("load",function(){a._confirm(!0,"onload")}),h(b).on("error",function(){a._confirm(!1,"onerror")}),b.src=a.src}},_confirm:function(a,b){this.isLoaded=a,this.isConfirmed=!0,this.fire("confirm",{isLoaded:a,message:b})}}),e},{requires:["node","base","event"]});